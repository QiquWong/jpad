clear all, close all, clc

%% load data file generated by Grabit
% https://it.mathworks.com/matlabcentral/fileexchange/7173-grabit

fileBaseNames = {'T_vs_h_frac_overline_c'};
nPoints = 29;

xx = linspace(0.2, 1.4, nPoints);
    
    fileName = sprintf('%s.mat',fileBaseNames{1});
    s = load(fileName, '-mat');

    % Allocate imported array to column variable names
    
    x = s.(fileBaseNames{1})(:, 1);
    %x = flipud(x);
    x(end) = 1.4;
    
    y = s.(fileBaseNames{1})(:, 2);
    %y = flipud(y);
    %y(1) = 0;
    
    %% Smoothing
    pp = csaps(x, y, 0.999999);
    c = ppval(pp(1), xx');
    data(:,1) = c;

    plot (xx', data(:,1), '-*');
   
xlabel('$\frac{h}{overline c}$','interpreter','latex'); 
ylabel('T');
set(get(gca,'ylabel'),'rotation',0)

title('Parameter accounting for variation in longitudinal velocity with ground height');
axis([0 1.4 0 9]);


%% preparing output to HDF


h_frac_overline_c = xx';

 
%columns --> curves
 
hdfFileName = 'Delta_alpha_G_T_vs_h_frac_overline_c.h5';

if ( exist(hdfFileName, 'file') )
    fprintf('file %s exists, deleting and creating a new one\n', hdfFileName);
    delete(hdfFileName)
else
    fprintf('Creating new file %s\n', hdfFileName);
end

h5create(hdfFileName, '/(Delta_alpha_G)_T_vs_h_frac_overline_c/data', size(data'));
h5write(hdfFileName, '/(Delta_alpha_G)_T_vs_h_frac_overline_c/data', data');

h5create(hdfFileName, '/(Delta_alpha_G)_T_vs_h_frac_overline_c/var_0', size(h_frac_overline_c'));
h5write(hdfFileName, '/(Delta_alpha_G)_T_vs_h_frac_overline_c/var_0', h_frac_overline_c');





