clear all

%% load data file generated by Grabit
% https://it.mathworks.com/matlabcentral/fileexchange/7173-grabit

fileBaseNames = {'KR_vs_lambda_eta_001', 'KR_vs_lambda_eta_002', 'KR_vs_lambda_eta_003'};
nPoints = 21;

xx = linspace(0.0, 1.0, nPoints);

for kFile = 1:length(fileBaseNames)
    
    fileName = sprintf('%s.mat',fileBaseNames{kFile});
    s = load(fileName, '-mat');

    % Allocate imported array to column variable names
    
    x{kFile} = s.(fileBaseNames{kFile})(:, 1);
    x{kFile}(1) = 0.0;
    x{kFile}(end) = 1.0;
    
    y{kFile} = s.(fileBaseNames{kFile})(:, 2);
    y{kFile}(1) = 0.0;
    y{kFile}(end) = 1.0;
    
    %% Smoothing
    pp(kFile) = csaps(x{kFile}, y{kFile}, 0.999999);
    c{kFile} = ppval(pp(kFile), xx');
    data(:,kFile) = c{kFile};
    data(1,kFile) = 0.0;
    data(end,kFile) = 1.0;

    plot (xx', data(:,kFile), '-*');
    hold on
end
xlabel('\eta'); ylabel('K_R');
title('Span factor between rudder and vertical tail');
axis([0 1 0 1]);
legend('0.0','0.5','1.0');


%% preparing output to HDF

taperRatios = [ 0.0; 0.5; 1.0 ];
etas = xx';

 
%columns --> curves
 
hdfFileName = 'C_y_delta_r_K_R_vs_lambda_eta.h5';

if ( exist(hdfFileName, 'file') )
    fprintf('file %s exists, deleting and creating a new one\n', hdfFileName);
    delete(hdfFileName)
else
    fprintf('Creating new file %s\n', hdfFileName);
end

h5create(hdfFileName, '/(C_y_delta_r)_K_R_vs_lambda_eta/data', size(data'));
h5write(hdfFileName, '/(C_y_delta_r)_K_R_vs_lambda_eta/data', data');

h5create(hdfFileName, '/(C_y_delta_r)_K_R_vs_lambda_eta/var_0', size(taperRatios'));
h5write(hdfFileName, '/(C_y_delta_r)_K_R_vs_lambda_eta/var_0', taperRatios');

h5create(hdfFileName, '/(C_y_delta_r)_K_R_vs_lambda_eta/var_1', size(etas'));
h5write(hdfFileName, '/(C_y_delta_r)_K_R_vs_lambda_eta/var_1', etas');

