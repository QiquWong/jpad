clear all, close all, clc

%% load data file generated by Grabit
% https://it.mathworks.com/matlabcentral/fileexchange/7173-grabit

fileBaseNames = {'L_L0_minus_1_vs_h_cr_4_cr_0' , 'L_L0_minus_1_vs_h_cr_4_cr_5' , 'L_L0_minus_1_vs_h_cr_4_cr_10' , 'L_L0_minus_1_vs_h_cr_4_cr_15' , 'L_L0_minus_1_vs_h_cr_4_cr_18' , 'L_L0_minus_1_vs_h_cr_4_cr_20' , 'L_L0_minus_1_vs_h_cr_4_cr_22' , 'L_L0_minus_1_vs_h_cr_4_cr_24' , 'L_L0_minus_1_vs_h_cr_4_cr_36'};
nPoints = 49;

xx = linspace(0.2, 2.4, nPoints);

for kFile = 1:length(fileBaseNames)
    
%     fileName = sprintf('%s.mat',fileBaseNames{kFile});
    s = load(fileBaseNames{kFile}, '-mat');

    % Allocate imported array to column variable names
    
    x{kFile} = s.(fileBaseNames{kFile})(:, 1);
    x{kFile}(end) = 2.4;
    
    y{kFile} = s.(fileBaseNames{kFile})(:, 2);
    %% Smoothing
    pp(kFile) = csaps(x{kFile}, y{kFile}, 0.999999);
    c{kFile} = ppval(pp(kFile), xx');
    data(:,kFile) = c{kFile};

    plot (xx', data(:,kFile), '-*');
    hold on
end
xlabel('$\frac{h_{{c_r}/4}}{c_r}$','interpreter','latex'); 
ylabel('$\frac{L}{L_0}-1$','interpreter','latex');
set(get(gca,'ylabel'),'rotation',0)

title('Parameter accounting for ground effect on lift due to trailing vortices');
axis([0 2.4 -0.5 .6]);
legend('0','5','10', '15','20','22' ,'24', '36');


%% preparing output to HDF

CL_2_2pi_cos_2_Gamma_c4 = [0 5 10 15 20 22 24 36]';
h_cr_4_cr = xx';

 
%columns --> curves
 
hdfFileName = 'Delta_alpha_CL_Ground_Effect_L_L0_minus1_vs_h_cr_4_cr';

if ( exist(hdfFileName, 'file') )
    fprintf('file %s exists, deleting and creating a new one\n', hdfFileName);
    delete(hdfFileName)
else
    fprintf('Creating new file %s\n', hdfFileName);
end

h5create(hdfFileName, '/(Delta_alpha_CL_Ground_Effect)_L_L0_minus1_vs_h_cr_4_cr/data', size(data'));
h5write(hdfFileName, '/(Delta_alpha_CL_Ground_Effect)_L_L0_minus1_vs_h_cr_4_cr/data', data');

h5create(hdfFileName, '/(Delta_alpha_CL_Ground_Effect)_L_L0_minus1_vs_h_cr_4_cr/var_0', size(CL_2_2pi_cos_2_Gamma_c4'));
h5write(hdfFileName, '/(Delta_alpha_CL_Ground_Effect)_L_L0_minus1_vs_h_cr_4_cr/var_0', CL_2_2pi_cos_2_Gamma_c4');

h5create(hdfFileName, '/(Delta_alpha_CL_Ground_Effect)_L_L0_minus1_vs_h_cr_4_cr/var_1', size(h_cr_4_cr'));
h5write(hdfFileName, '/(Delta_alpha_CL_Ground_Effect)_L_L0_minus1_vs_h_cr_4_cr/var_1', h_cr_4_cr');

