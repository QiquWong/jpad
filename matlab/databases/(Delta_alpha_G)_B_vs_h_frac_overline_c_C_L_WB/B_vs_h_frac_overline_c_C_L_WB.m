clear all, close all, clc

%% load data file generated by Grabit
% https://it.mathworks.com/matlabcentral/fileexchange/7173-grabit

fileBaseNames = {'B_vs_h_frac_overline_c_C_L_WB_0' , 'B_vs_h_frac_overline_c_C_L_WB_02' , 'B_vs_h_frac_overline_c_C_L_WB_04' , 'B_vs_h_frac_overline_c_C_L_WB_06' , 'B_vs_h_frac_overline_c_C_L_WB_08' , 'B_vs_h_frac_overline_c_C_L_WB_1' , 'B_vs_h_frac_overline_c_C_L_WB_12' , 'B_vs_h_frac_overline_c_C_L_WB_14' , 'B_vs_h_frac_overline_c_C_L_WB_16'};
nPoints = 41;

xx = linspace(0.2, 2.4, nPoints);

for kFile = 1:length(fileBaseNames)
    
%     fileName = sprintf('%s.mat',fileBaseNames{kFile});
    s = load(fileBaseNames{kFile}, '-mat');

    % Allocate imported array to column variable names
    
    x{kFile} = s.(fileBaseNames{kFile})(:, 1);
    x{kFile}(end) = 2.4;
    
    y{kFile} = s.(fileBaseNames{kFile})(:, 2);
    %% Smoothing
    pp(kFile) = csaps(x{kFile}, y{kFile}, 0.999999);
    c{kFile} = ppval(pp(kFile), xx');
    data(:,kFile) = c{kFile};

    plot (xx', data(:,kFile), '-*');
    hold on
end
xlabel('B(deg)'); 
ylabel('$\frac{h}{\overline c}$','interpreter','latex');
set(get(gca,'ylabel'),'rotation',0)

title('Parameter accounting for ground effect on lift due to trailing vortices');
axis([0.2 1.2 -0.4 4]);
legend('0','0.2','0.4', '0.6','0.8','1' ,'1.2', '1.4', '1.6');


%% preparing output to HDF

CL_wb = [0 0.2 0.4 0.6 0.8 1 1.2 1.4 1.6]';
h_c = xx';

 
%columns --> curves
 
hdfFileName = 'Delta_alpha_G_B_vs_h_frac_overline_c_C_L_WB';

if ( exist(hdfFileName, 'file') )
    fprintf('file %s exists, deleting and creating a new one\n', hdfFileName);
    delete(hdfFileName)
else
    fprintf('Creating new file %s\n', hdfFileName);
end

h5create(hdfFileName, '/(Delta_alpha_G)_B_vs_h_frac_overline_c_C_L_WB/data', size(data'));
h5write(hdfFileName, '/(Delta_alpha_G)_B_vs_h_frac_overline_c_C_L_WB/data', data');

h5create(hdfFileName, '/(Delta_alpha_G)_B_vs_h_frac_overline_c_C_L_WB/var_0', size(CL_wb'));
h5write(hdfFileName, '/(Delta_alpha_G)_B_vs_h_frac_overline_c_C_L_WB/var_0', CL_wb');

h5create(hdfFileName, '/(Delta_alpha_G)_B_vs_h_frac_overline_c_C_L_WB/var_1', size(h_c'));
h5write(hdfFileName, '/(Delta_alpha_G)_B_vs_h_frac_overline_c_C_L_WB/var_1', h_c');

