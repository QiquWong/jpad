clear all, close all, clc

%% load data file generated by Grabit
% https://it.mathworks.com/matlabcentral/fileexchange/7173-grabit

fileBaseNames = {'x_vs_2hfracb_minus1', 'x_vs_2hfracb_minus05', 'x_vs_2hfracb_minus02', 'x_vs_2hfracb_0', 'x_vs_2hfracb_02', 'x_vs_2hfracb_05', 'x_vs_2hfracb_1'};
nPoints = 21;

xx = linspace(0.0, 1.0, nPoints);

for kFile = 1:length(fileBaseNames)
    
    fileName = sprintf('%s.mat',fileBaseNames{kFile});
    s = load(fileName, '-mat');

    % Allocate imported array to column variable names
    
    x{kFile} = s.(fileBaseNames{kFile})(:, 1);
    x{kFile}(1) = 0.0;
    x{kFile}(end) = 1.0;
    
    y{kFile} = s.(fileBaseNames{kFile})(:, 2);
    
    %% Smoothing
    pp(kFile) = csaps(x{kFile}, y{kFile}, 0.999999);
    c{kFile} = ppval(pp(kFile), xx');
    data(:,kFile) = c{kFile};

    plot (xx', data(:,kFile), '-*');
    hold on
end
xlabel('$\frac{h}{b/2}$','interpreter','latex'); 
ylabel('x');
set(get(gca,'ylabel'),'rotation',180)

title('Parameter accounting for ground effect on lift due to trailing vortices');
axis([0 1 0 1.6]);
legend('-1','-.5','-.2', '0','0.2','0.5' ,'1');


%% preparing output to HDF

Deltax = [ -1 -.5 -.2 0 0.2 0.5 1 ]';
hb_2 = xx';

 
%columns --> curves
 
hdfFileName = 'Delta_alpha_CL_Ground_Effect_x_vs_2hfracb_Deltax.h5';

if ( exist(hdfFileName, 'file') )
    fprintf('file %s exists, deleting and creating a new one\n', hdfFileName);
    delete(hdfFileName)
else
    fprintf('Creating new file %s\n', hdfFileName);
end

h5create(hdfFileName, '/(Delta_alpha_CL_Ground_Effect)_x_vs_2hfracb_Deltax/data', size(data'));
h5write(hdfFileName, '/(Delta_alpha_CL_Ground_Effect)_x_vs_2hfracb_Deltax/data', data');

h5create(hdfFileName, '/(Delta_alpha_CL_Ground_Effect)_x_vs_2hfracb_Deltax/var_0', size(Deltax'));
h5write(hdfFileName, '/(Delta_alpha_CL_Ground_Effect)_x_vs_2hfracb_Deltax/var_0', Deltax');

h5create(hdfFileName, '/(Delta_alpha_CL_Ground_Effect)_x_vs_2hfracb_Deltax/var_1', size(hb_2'));
h5write(hdfFileName, '/(Delta_alpha_CL_Ground_Effect)_x_vs_2hfracb_Deltax/var_1', hb_2');

